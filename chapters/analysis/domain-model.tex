\section{Domain model}\label{sec:domain-model}

Following analysis of requirements, use cases and their scenarios, I will further introduce the domain model.
By domain model, we understand a conceptual model of the domain that incorporates both behaviour and data\cite{wiki-domain-model}.

Based on the previous analysis, I identified following entities:

\begin{itemize}
    \item QuestionnaireMigration,
    \item DiffEvent,
    \item Questionnaire,
    \item KnowledgeModel,
    \item QuestionFlag,
    \item Chapter,
    \item Question,
    \item Reply.
\end{itemize}

Figure \ref{fig:domain-model} shows all identified entities and relationships between them.
Some of the entities already exists in the \gls{dsw}, my analysis was therefore also based on Ing. VojtÄ›ch Knaisl's master's thesis\cite{mt-knails} previously mentioned in chapter \ref{cptr:state-of-the-art}.
Such entities are explicitly marked in the following list of entities.

\image{fig:domain-model}{Domain model with relationships between entities}{domain-model}

\subsection{QuestionnaireMigration entity}

This entity represents the migration itself.
It is composed using all entities which are required to create the migration context.
The requirements demands that there must be at most one migration for each questionnaire in one moment.

Migration is created by user when he wants to use newer version of knowledge model.

\subsection{DiffEvent entity}

This entity represents an event which occured during knowledge model customization.
Events are further described in section \ref{sec:event-driven-architecture}.
Data stewards create events while making customization to the knowledge model in \texttt{KMEditor} module (discussed in \ref{sec:kmeditor-module}).

The list of events is used to create set of changes which are presented to the user.

This entity is already part of the application.

\subsection{Questionnaire entity}

The \texttt{Questionnaire} entity represents currently migrated questionnaire.
It is created by an arbitrary user in the \texttt{Questionnaires} module (described in \ref{sec:questionnaires-module}).

\texttt{QuestionnaireMigration} module use questionnaires to make preview of changes in context of the user answers.

\subsection{KnowledgeModel entity}

Knowledge models contains hierarchical structure of chapters, questions and answers.
In the migration, it is used to for comparisons between new and previous versions of the knowledge model.

There is an special structure called \texttt{DiffKnowledgeModel} used in the migration process.
It has the same structure as migrated knowledge model but contains also nodes, which were deleted -- this enables user to explore context of nodes which will no longer be available after the migration is finished.

\texttt{KnowledgeModel} entity is already part of the application.

\subsection{QuestionFlag entity}

Flags are used to represent question state.
Since flags are not only used during migration, but also in questionnaire preview, the are related to the questionnaire instead of migration.

\subsection{Chapter entity}

Chapters are used to group questions into logical parts.
In addition to relation to questions, chapters contains title and description text.

This entity is already part of the application.

\subsection{Question entity}

Questions are used to questionnaires to collect data from users.
This entity is created by the application when creating (building) knowledge model from list of events.

This entity is already part of the application.

\subsection{Answer entity}

This entity is used represent answer replied by user to a question.
There are more types of question such as open-ended, single choice or structured (composed from another questions).

Single choice answers may also have follow-up questions which needs to be prelied to too.

The answer entity is already part of the application.

\subsection{Reply entity}

Reply entitiy represents selected answer for questionnaire question.
It is created by user when filling up questionnaire in \texttt{Questionnaires} module.

Non-functional requirements demands to preserve the reply if it is compatible with newer knowledge model.

This entity is already part of the application.
