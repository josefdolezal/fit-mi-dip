\section{Questionnaire structure}\label{sec:questionnaire-structure}

Questionnaire structurure represents view panel where user is able to preview all nodes and answer paths.
This structure is created from knowledge model nodes combined with user's replies.

\subsection{Creating the structure}

The hierarchical structure is created using lookup table keyed by string identifiers.
The final lookup table is generated by recursively passing through knowledge model and its successors.

Each successor is then also recursively inserting its successors until it founds a leaf (either question, answer or reply) of the tree.
Nodes are added into lookup table by its unique path in the tree.
The path is given by chaining sequence of predecessors' identifiers combined using period (.) character.
This helps to distinguish nodes with the identifier inserted into multiple locations in the tree while maintaining compatibility with the current implementation of replies identification.

\subsection{Meta nodes}\label{sec:meta-nodes}

To accomplish clear structure of user's replies, some questions requires to insert meta nodes which actually does not exists in the tree.
Such strategy is used for the template items question type, where user is required to reply by filling structure of nested questions.

\begin{figure}[H]
	\dirtree{%
		.1 Common ELIXIR Knowledge Model.
		.2 Chapter -- Design of experiment.
		.3 Question -- What database will you use?.
        .4 Q1 -- What is the name of the database?.
        .4 Q2 -- What version of the database?.
        .4 Q3 -- Is it an open-source database?.
        .5 Answer -- Yes.
        .5 Answer -- No.
    }
    \caption{Item template question type example}\label{fig:item-template}
\end{figure}

In the example \ref{fig:item-template}, the researcher might want to use multiple databases and thefore would reply by creating multiple filling the template multiple times.
This would created \texttt{Reply} entity for each question by inserting index tag of the item into the nodes paths.
Knowledge models, however does not support such paths and replies cannot be directly applied to it because of that.

\subsubsection*{Item templates replies}

As mentioned in the introduction to this section, knowledge model must be combined with user's replies to correctly render meta items and answers.
For database question example mentioned above, the final rendered tree would look like the on figure \ref{fig:item-template-items} for two replied items.

\begin{figure}[H]
	\dirtree{%
		.1 Common ELIXIR Knowledge Model.
		.2 Chapter -- Design of experiment.
        .3 Question -- What database will you use?.
        .4 Item 1.
        .5 Q1 -- What is the name of the database?.
        .5 Q2 -- What version of the database?.
        .5 Q3 -- Is it an open-source database?.
        .6 Answer -- Yes.
        .6 Answer -- No.
        .4 Item 2.
        .5 Q1 -- What is the name of the database?.
        .5 Q2 -- What version of the database?.
        .5 Q3 -- Is it an open-source database?.
        .6 Answer -- Yes.
        .6 Answer -- No.
    }
    \caption{Tree representation for item teplate replies}\label{fig:item-template-items}
\end{figure}

By selecting selecting any of the node nested in the item template, user will be able to see appropriate answer.
There might be however case, where user did not reply by any item template and therefore there is no meta node which would render nested questions.
In such case, the tree would have \textit{flat} structure as in figure \ref{fig:item-template}.
